9a4c07ad1af1030e4fb53077476db26b
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.onGestureHandlerEvent = onGestureHandlerEvent;
exports.startListening = startListening;
exports.stopListening = stopListening;
var _reactNative = require("react-native");
var _State = require("../../State");
var _TouchEventType = require("../../TouchEventType");
var _handlersRegistry = require("../handlersRegistry");
var _gestureStateManager = require("./gestureStateManager");
var gestureHandlerEventSubscription = null;
var gestureHandlerStateChangeEventSubscription = null;
var gestureStateManagers = new Map();
var lastUpdateEvent = [];
function isStateChangeEvent(event) {
  return event.oldState != null;
}
function isTouchEvent(event) {
  return event.eventType != null;
}
function onGestureHandlerEvent(event) {
  var _handler$handlers7, _handler$handlers7$on, _handler$handlers8, _handler$handlers8$on, _handler$handlers9, _handler$handlers9$on, _handler$handlers10, _handler$handlers10$o;
  var handler = (0, _handlersRegistry.findHandler)(event.handlerTag);
  if (handler) {
    if (isStateChangeEvent(event)) {
      if (event.oldState === _State.State.UNDETERMINED && event.state === _State.State.BEGAN) {
        var _handler$handlers$onB, _handler$handlers;
        (_handler$handlers$onB = (_handler$handlers = handler.handlers).onBegin) === null || _handler$handlers$onB === void 0 ? void 0 : _handler$handlers$onB.call(_handler$handlers, event);
      } else if ((event.oldState === _State.State.BEGAN || event.oldState === _State.State.UNDETERMINED) && event.state === _State.State.ACTIVE) {
        var _handler$handlers$onS, _handler$handlers2;
        (_handler$handlers$onS = (_handler$handlers2 = handler.handlers).onStart) === null || _handler$handlers$onS === void 0 ? void 0 : _handler$handlers$onS.call(_handler$handlers2, event);
        lastUpdateEvent[handler.handlers.handlerTag] = event;
      } else if (event.oldState !== event.state && event.state === _State.State.END) {
        var _handler$handlers$onF, _handler$handlers4;
        if (event.oldState === _State.State.ACTIVE) {
          var _handler$handlers$onE, _handler$handlers3;
          (_handler$handlers$onE = (_handler$handlers3 = handler.handlers).onEnd) === null || _handler$handlers$onE === void 0 ? void 0 : _handler$handlers$onE.call(_handler$handlers3, event, true);
        }
        (_handler$handlers$onF = (_handler$handlers4 = handler.handlers).onFinalize) === null || _handler$handlers$onF === void 0 ? void 0 : _handler$handlers$onF.call(_handler$handlers4, event, true);
        lastUpdateEvent[handler.handlers.handlerTag] = undefined;
      } else if ((event.state === _State.State.FAILED || event.state === _State.State.CANCELLED) && event.oldState !== event.state) {
        var _handler$handlers$onF2, _handler$handlers6;
        if (event.oldState === _State.State.ACTIVE) {
          var _handler$handlers$onE2, _handler$handlers5;
          (_handler$handlers$onE2 = (_handler$handlers5 = handler.handlers).onEnd) === null || _handler$handlers$onE2 === void 0 ? void 0 : _handler$handlers$onE2.call(_handler$handlers5, event, false);
        }
        (_handler$handlers$onF2 = (_handler$handlers6 = handler.handlers).onFinalize) === null || _handler$handlers$onF2 === void 0 ? void 0 : _handler$handlers$onF2.call(_handler$handlers6, event, false);
        gestureStateManagers.delete(event.handlerTag);
        lastUpdateEvent[handler.handlers.handlerTag] = undefined;
      }
    } else if (isTouchEvent(event)) {
      if (!gestureStateManagers.has(event.handlerTag)) {
        gestureStateManagers.set(event.handlerTag, _gestureStateManager.GestureStateManager.create(event.handlerTag));
      }
      var manager = gestureStateManagers.get(event.handlerTag);
      switch (event.eventType) {
        case _TouchEventType.TouchEventType.TOUCHES_DOWN:
          (_handler$handlers7 = handler.handlers) === null || _handler$handlers7 === void 0 ? void 0 : (_handler$handlers7$on = _handler$handlers7.onTouchesDown) === null || _handler$handlers7$on === void 0 ? void 0 : _handler$handlers7$on.call(_handler$handlers7, event, manager);
          break;
        case _TouchEventType.TouchEventType.TOUCHES_MOVE:
          (_handler$handlers8 = handler.handlers) === null || _handler$handlers8 === void 0 ? void 0 : (_handler$handlers8$on = _handler$handlers8.onTouchesMove) === null || _handler$handlers8$on === void 0 ? void 0 : _handler$handlers8$on.call(_handler$handlers8, event, manager);
          break;
        case _TouchEventType.TouchEventType.TOUCHES_UP:
          (_handler$handlers9 = handler.handlers) === null || _handler$handlers9 === void 0 ? void 0 : (_handler$handlers9$on = _handler$handlers9.onTouchesUp) === null || _handler$handlers9$on === void 0 ? void 0 : _handler$handlers9$on.call(_handler$handlers9, event, manager);
          break;
        case _TouchEventType.TouchEventType.TOUCHES_CANCELLED:
          (_handler$handlers10 = handler.handlers) === null || _handler$handlers10 === void 0 ? void 0 : (_handler$handlers10$o = _handler$handlers10.onTouchesCancelled) === null || _handler$handlers10$o === void 0 ? void 0 : _handler$handlers10$o.call(_handler$handlers10, event, manager);
          break;
      }
    } else {
      var _handler$handlers$onU, _handler$handlers11;
      (_handler$handlers$onU = (_handler$handlers11 = handler.handlers).onUpdate) === null || _handler$handlers$onU === void 0 ? void 0 : _handler$handlers$onU.call(_handler$handlers11, event);
      if (handler.handlers.onChange && handler.handlers.changeEventCalculator) {
        var _handler$handlers$onC, _handler$handlers12, _handler$handlers$cha, _handler$handlers13;
        (_handler$handlers$onC = (_handler$handlers12 = handler.handlers).onChange) === null || _handler$handlers$onC === void 0 ? void 0 : _handler$handlers$onC.call(_handler$handlers12, (_handler$handlers$cha = (_handler$handlers13 = handler.handlers).changeEventCalculator) === null || _handler$handlers$cha === void 0 ? void 0 : _handler$handlers$cha.call(_handler$handlers13, event, lastUpdateEvent[handler.handlers.handlerTag]));
        lastUpdateEvent[handler.handlers.handlerTag] = event;
      }
    }
  } else {
    var oldHandler = (0, _handlersRegistry.findOldGestureHandler)(event.handlerTag);
    if (oldHandler) {
      var nativeEvent = {
        nativeEvent: event
      };
      if (isStateChangeEvent(event)) {
        oldHandler.onGestureStateChange(nativeEvent);
      } else {
        oldHandler.onGestureEvent(nativeEvent);
      }
      return;
    }
  }
}
function startListening() {
  stopListening();
  gestureHandlerEventSubscription = _reactNative.DeviceEventEmitter.addListener('onGestureHandlerEvent', onGestureHandlerEvent);
  gestureHandlerStateChangeEventSubscription = _reactNative.DeviceEventEmitter.addListener('onGestureHandlerStateChange', onGestureHandlerEvent);
}
function stopListening() {
  if (gestureHandlerEventSubscription) {
    gestureHandlerEventSubscription.remove();
    gestureHandlerEventSubscription = null;
  }
  if (gestureHandlerStateChangeEventSubscription) {
    gestureHandlerStateChangeEventSubscription.remove();
    gestureHandlerStateChangeEventSubscription = null;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3ROYXRpdmUiLCJyZXF1aXJlIiwiX1N0YXRlIiwiX1RvdWNoRXZlbnRUeXBlIiwiX2hhbmRsZXJzUmVnaXN0cnkiLCJfZ2VzdHVyZVN0YXRlTWFuYWdlciIsImdlc3R1cmVIYW5kbGVyRXZlbnRTdWJzY3JpcHRpb24iLCJnZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnRTdWJzY3JpcHRpb24iLCJnZXN0dXJlU3RhdGVNYW5hZ2VycyIsIk1hcCIsImxhc3RVcGRhdGVFdmVudCIsImlzU3RhdGVDaGFuZ2VFdmVudCIsImV2ZW50Iiwib2xkU3RhdGUiLCJpc1RvdWNoRXZlbnQiLCJldmVudFR5cGUiLCJvbkdlc3R1cmVIYW5kbGVyRXZlbnQiLCJfaGFuZGxlciRoYW5kbGVyczciLCJfaGFuZGxlciRoYW5kbGVyczckb24iLCJfaGFuZGxlciRoYW5kbGVyczgiLCJfaGFuZGxlciRoYW5kbGVyczgkb24iLCJfaGFuZGxlciRoYW5kbGVyczkiLCJfaGFuZGxlciRoYW5kbGVyczkkb24iLCJfaGFuZGxlciRoYW5kbGVyczEwIiwiX2hhbmRsZXIkaGFuZGxlcnMxMCRvIiwiaGFuZGxlciIsImZpbmRIYW5kbGVyIiwiaGFuZGxlclRhZyIsIlN0YXRlIiwiVU5ERVRFUk1JTkVEIiwic3RhdGUiLCJCRUdBTiIsIl9oYW5kbGVyJGhhbmRsZXJzJG9uQiIsIl9oYW5kbGVyJGhhbmRsZXJzIiwiaGFuZGxlcnMiLCJvbkJlZ2luIiwiY2FsbCIsIkFDVElWRSIsIl9oYW5kbGVyJGhhbmRsZXJzJG9uUyIsIl9oYW5kbGVyJGhhbmRsZXJzMiIsIm9uU3RhcnQiLCJFTkQiLCJfaGFuZGxlciRoYW5kbGVycyRvbkYiLCJfaGFuZGxlciRoYW5kbGVyczQiLCJfaGFuZGxlciRoYW5kbGVycyRvbkUiLCJfaGFuZGxlciRoYW5kbGVyczMiLCJvbkVuZCIsIm9uRmluYWxpemUiLCJ1bmRlZmluZWQiLCJGQUlMRUQiLCJDQU5DRUxMRUQiLCJfaGFuZGxlciRoYW5kbGVycyRvbkYyIiwiX2hhbmRsZXIkaGFuZGxlcnM2IiwiX2hhbmRsZXIkaGFuZGxlcnMkb25FMiIsIl9oYW5kbGVyJGhhbmRsZXJzNSIsImRlbGV0ZSIsImhhcyIsInNldCIsIkdlc3R1cmVTdGF0ZU1hbmFnZXIiLCJjcmVhdGUiLCJtYW5hZ2VyIiwiZ2V0IiwiVG91Y2hFdmVudFR5cGUiLCJUT1VDSEVTX0RPV04iLCJvblRvdWNoZXNEb3duIiwiVE9VQ0hFU19NT1ZFIiwib25Ub3VjaGVzTW92ZSIsIlRPVUNIRVNfVVAiLCJvblRvdWNoZXNVcCIsIlRPVUNIRVNfQ0FOQ0VMTEVEIiwib25Ub3VjaGVzQ2FuY2VsbGVkIiwiX2hhbmRsZXIkaGFuZGxlcnMkb25VIiwiX2hhbmRsZXIkaGFuZGxlcnMxMSIsIm9uVXBkYXRlIiwib25DaGFuZ2UiLCJjaGFuZ2VFdmVudENhbGN1bGF0b3IiLCJfaGFuZGxlciRoYW5kbGVycyRvbkMiLCJfaGFuZGxlciRoYW5kbGVyczEyIiwiX2hhbmRsZXIkaGFuZGxlcnMkY2hhIiwiX2hhbmRsZXIkaGFuZGxlcnMxMyIsIm9sZEhhbmRsZXIiLCJmaW5kT2xkR2VzdHVyZUhhbmRsZXIiLCJuYXRpdmVFdmVudCIsIm9uR2VzdHVyZVN0YXRlQ2hhbmdlIiwib25HZXN0dXJlRXZlbnQiLCJzdGFydExpc3RlbmluZyIsInN0b3BMaXN0ZW5pbmciLCJEZXZpY2VFdmVudEVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInJlbW92ZSJdLCJzb3VyY2VzIjpbImV2ZW50UmVjZWl2ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGV2aWNlRXZlbnRFbWl0dGVyLCBFbWl0dGVyU3Vic2NyaXB0aW9uIH0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCB7IFN0YXRlIH0gZnJvbSAnLi4vLi4vU3RhdGUnO1xuaW1wb3J0IHsgVG91Y2hFdmVudFR5cGUgfSBmcm9tICcuLi8uLi9Ub3VjaEV2ZW50VHlwZSc7XG5pbXBvcnQge1xuICBHZXN0dXJlVG91Y2hFdmVudCxcbiAgR2VzdHVyZVVwZGF0ZUV2ZW50LFxuICBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudCxcbn0gZnJvbSAnLi4vZ2VzdHVyZUhhbmRsZXJDb21tb24nO1xuaW1wb3J0IHsgZmluZEhhbmRsZXIsIGZpbmRPbGRHZXN0dXJlSGFuZGxlciB9IGZyb20gJy4uL2hhbmRsZXJzUmVnaXN0cnknO1xuaW1wb3J0IHsgQmFzZUdlc3R1cmUgfSBmcm9tICcuL2dlc3R1cmUnO1xuaW1wb3J0IHtcbiAgR2VzdHVyZVN0YXRlTWFuYWdlcixcbiAgR2VzdHVyZVN0YXRlTWFuYWdlclR5cGUsXG59IGZyb20gJy4vZ2VzdHVyZVN0YXRlTWFuYWdlcic7XG5cbmxldCBnZXN0dXJlSGFuZGxlckV2ZW50U3Vic2NyaXB0aW9uOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHwgbnVsbCA9IG51bGw7XG5sZXQgZ2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50U3Vic2NyaXB0aW9uOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHwgbnVsbCA9XG4gIG51bGw7XG5cbmNvbnN0IGdlc3R1cmVTdGF0ZU1hbmFnZXJzOiBNYXA8bnVtYmVyLCBHZXN0dXJlU3RhdGVNYW5hZ2VyVHlwZT4gPSBuZXcgTWFwPFxuICBudW1iZXIsXG4gIEdlc3R1cmVTdGF0ZU1hbmFnZXJUeXBlXG4+KCk7XG5cbmNvbnN0IGxhc3RVcGRhdGVFdmVudDogKEdlc3R1cmVVcGRhdGVFdmVudCB8IHVuZGVmaW5lZClbXSA9IFtdO1xuXG5mdW5jdGlvbiBpc1N0YXRlQ2hhbmdlRXZlbnQoXG4gIGV2ZW50OiBHZXN0dXJlVXBkYXRlRXZlbnQgfCBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudCB8IEdlc3R1cmVUb3VjaEV2ZW50XG4pOiBldmVudCBpcyBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudCB7XG4gIC8vIEB0cy1pZ25vcmUgb2xkU3RhdGUgZG9lc24ndCBleGlzdCBvbiBHZXN0dXJlVG91Y2hFdmVudCBhbmQgdGhhdCdzIHRoZSBwb2ludFxuICByZXR1cm4gZXZlbnQub2xkU3RhdGUgIT0gbnVsbDtcbn1cblxuZnVuY3Rpb24gaXNUb3VjaEV2ZW50KFxuICBldmVudDogR2VzdHVyZVVwZGF0ZUV2ZW50IHwgR2VzdHVyZVN0YXRlQ2hhbmdlRXZlbnQgfCBHZXN0dXJlVG91Y2hFdmVudFxuKTogZXZlbnQgaXMgR2VzdHVyZVRvdWNoRXZlbnQge1xuICByZXR1cm4gZXZlbnQuZXZlbnRUeXBlICE9IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbkdlc3R1cmVIYW5kbGVyRXZlbnQoXG4gIGV2ZW50OiBHZXN0dXJlVXBkYXRlRXZlbnQgfCBHZXN0dXJlU3RhdGVDaGFuZ2VFdmVudCB8IEdlc3R1cmVUb3VjaEV2ZW50XG4pIHtcbiAgY29uc3QgaGFuZGxlciA9IGZpbmRIYW5kbGVyKGV2ZW50LmhhbmRsZXJUYWcpIGFzIEJhc2VHZXN0dXJlPFxuICAgIFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gID47XG5cbiAgaWYgKGhhbmRsZXIpIHtcbiAgICBpZiAoaXNTdGF0ZUNoYW5nZUV2ZW50KGV2ZW50KSkge1xuICAgICAgaWYgKFxuICAgICAgICBldmVudC5vbGRTdGF0ZSA9PT0gU3RhdGUuVU5ERVRFUk1JTkVEICYmXG4gICAgICAgIGV2ZW50LnN0YXRlID09PSBTdGF0ZS5CRUdBTlxuICAgICAgKSB7XG4gICAgICAgIGhhbmRsZXIuaGFuZGxlcnMub25CZWdpbj8uKGV2ZW50KTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIChldmVudC5vbGRTdGF0ZSA9PT0gU3RhdGUuQkVHQU4gfHxcbiAgICAgICAgICBldmVudC5vbGRTdGF0ZSA9PT0gU3RhdGUuVU5ERVRFUk1JTkVEKSAmJlxuICAgICAgICBldmVudC5zdGF0ZSA9PT0gU3RhdGUuQUNUSVZFXG4gICAgICApIHtcbiAgICAgICAgaGFuZGxlci5oYW5kbGVycy5vblN0YXJ0Py4oZXZlbnQpO1xuICAgICAgICBsYXN0VXBkYXRlRXZlbnRbaGFuZGxlci5oYW5kbGVycy5oYW5kbGVyVGFnXSA9IGV2ZW50O1xuICAgICAgfSBlbHNlIGlmIChldmVudC5vbGRTdGF0ZSAhPT0gZXZlbnQuc3RhdGUgJiYgZXZlbnQuc3RhdGUgPT09IFN0YXRlLkVORCkge1xuICAgICAgICBpZiAoZXZlbnQub2xkU3RhdGUgPT09IFN0YXRlLkFDVElWRSkge1xuICAgICAgICAgIGhhbmRsZXIuaGFuZGxlcnMub25FbmQ/LihldmVudCwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlci5oYW5kbGVycy5vbkZpbmFsaXplPy4oZXZlbnQsIHRydWUpO1xuICAgICAgICBsYXN0VXBkYXRlRXZlbnRbaGFuZGxlci5oYW5kbGVycy5oYW5kbGVyVGFnXSA9IHVuZGVmaW5lZDtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIChldmVudC5zdGF0ZSA9PT0gU3RhdGUuRkFJTEVEIHx8IGV2ZW50LnN0YXRlID09PSBTdGF0ZS5DQU5DRUxMRUQpICYmXG4gICAgICAgIGV2ZW50Lm9sZFN0YXRlICE9PSBldmVudC5zdGF0ZVxuICAgICAgKSB7XG4gICAgICAgIGlmIChldmVudC5vbGRTdGF0ZSA9PT0gU3RhdGUuQUNUSVZFKSB7XG4gICAgICAgICAgaGFuZGxlci5oYW5kbGVycy5vbkVuZD8uKGV2ZW50LCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlci5oYW5kbGVycy5vbkZpbmFsaXplPy4oZXZlbnQsIGZhbHNlKTtcbiAgICAgICAgZ2VzdHVyZVN0YXRlTWFuYWdlcnMuZGVsZXRlKGV2ZW50LmhhbmRsZXJUYWcpO1xuICAgICAgICBsYXN0VXBkYXRlRXZlbnRbaGFuZGxlci5oYW5kbGVycy5oYW5kbGVyVGFnXSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGlzVG91Y2hFdmVudChldmVudCkpIHtcbiAgICAgIGlmICghZ2VzdHVyZVN0YXRlTWFuYWdlcnMuaGFzKGV2ZW50LmhhbmRsZXJUYWcpKSB7XG4gICAgICAgIGdlc3R1cmVTdGF0ZU1hbmFnZXJzLnNldChcbiAgICAgICAgICBldmVudC5oYW5kbGVyVGFnLFxuICAgICAgICAgIEdlc3R1cmVTdGF0ZU1hbmFnZXIuY3JlYXRlKGV2ZW50LmhhbmRsZXJUYWcpXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICBjb25zdCBtYW5hZ2VyID0gZ2VzdHVyZVN0YXRlTWFuYWdlcnMuZ2V0KGV2ZW50LmhhbmRsZXJUYWcpITtcblxuICAgICAgc3dpdGNoIChldmVudC5ldmVudFR5cGUpIHtcbiAgICAgICAgY2FzZSBUb3VjaEV2ZW50VHlwZS5UT1VDSEVTX0RPV046XG4gICAgICAgICAgaGFuZGxlci5oYW5kbGVycz8ub25Ub3VjaGVzRG93bj8uKGV2ZW50LCBtYW5hZ2VyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBUb3VjaEV2ZW50VHlwZS5UT1VDSEVTX01PVkU6XG4gICAgICAgICAgaGFuZGxlci5oYW5kbGVycz8ub25Ub3VjaGVzTW92ZT8uKGV2ZW50LCBtYW5hZ2VyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBUb3VjaEV2ZW50VHlwZS5UT1VDSEVTX1VQOlxuICAgICAgICAgIGhhbmRsZXIuaGFuZGxlcnM/Lm9uVG91Y2hlc1VwPy4oZXZlbnQsIG1hbmFnZXIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFRvdWNoRXZlbnRUeXBlLlRPVUNIRVNfQ0FOQ0VMTEVEOlxuICAgICAgICAgIGhhbmRsZXIuaGFuZGxlcnM/Lm9uVG91Y2hlc0NhbmNlbGxlZD8uKGV2ZW50LCBtYW5hZ2VyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaGFuZGxlci5oYW5kbGVycy5vblVwZGF0ZT8uKGV2ZW50KTtcblxuICAgICAgaWYgKGhhbmRsZXIuaGFuZGxlcnMub25DaGFuZ2UgJiYgaGFuZGxlci5oYW5kbGVycy5jaGFuZ2VFdmVudENhbGN1bGF0b3IpIHtcbiAgICAgICAgaGFuZGxlci5oYW5kbGVycy5vbkNoYW5nZT8uKFxuICAgICAgICAgIGhhbmRsZXIuaGFuZGxlcnMuY2hhbmdlRXZlbnRDYWxjdWxhdG9yPy4oXG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGxhc3RVcGRhdGVFdmVudFtoYW5kbGVyLmhhbmRsZXJzLmhhbmRsZXJUYWddXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAgIGxhc3RVcGRhdGVFdmVudFtoYW5kbGVyLmhhbmRsZXJzLmhhbmRsZXJUYWddID0gZXZlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IG9sZEhhbmRsZXIgPSBmaW5kT2xkR2VzdHVyZUhhbmRsZXIoZXZlbnQuaGFuZGxlclRhZyk7XG4gICAgaWYgKG9sZEhhbmRsZXIpIHtcbiAgICAgIGNvbnN0IG5hdGl2ZUV2ZW50ID0geyBuYXRpdmVFdmVudDogZXZlbnQgfTtcbiAgICAgIGlmIChpc1N0YXRlQ2hhbmdlRXZlbnQoZXZlbnQpKSB7XG4gICAgICAgIG9sZEhhbmRsZXIub25HZXN0dXJlU3RhdGVDaGFuZ2UobmF0aXZlRXZlbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2xkSGFuZGxlci5vbkdlc3R1cmVFdmVudChuYXRpdmVFdmVudCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdGFydExpc3RlbmluZygpIHtcbiAgc3RvcExpc3RlbmluZygpO1xuXG4gIGdlc3R1cmVIYW5kbGVyRXZlbnRTdWJzY3JpcHRpb24gPSBEZXZpY2VFdmVudEVtaXR0ZXIuYWRkTGlzdGVuZXIoXG4gICAgJ29uR2VzdHVyZUhhbmRsZXJFdmVudCcsXG4gICAgb25HZXN0dXJlSGFuZGxlckV2ZW50XG4gICk7XG5cbiAgZ2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZUV2ZW50U3Vic2NyaXB0aW9uID0gRGV2aWNlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKFxuICAgICdvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UnLFxuICAgIG9uR2VzdHVyZUhhbmRsZXJFdmVudFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RvcExpc3RlbmluZygpIHtcbiAgaWYgKGdlc3R1cmVIYW5kbGVyRXZlbnRTdWJzY3JpcHRpb24pIHtcbiAgICBnZXN0dXJlSGFuZGxlckV2ZW50U3Vic2NyaXB0aW9uLnJlbW92ZSgpO1xuICAgIGdlc3R1cmVIYW5kbGVyRXZlbnRTdWJzY3JpcHRpb24gPSBudWxsO1xuICB9XG5cbiAgaWYgKGdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFN1YnNjcmlwdGlvbikge1xuICAgIGdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2VFdmVudFN1YnNjcmlwdGlvbi5yZW1vdmUoKTtcbiAgICBnZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlRXZlbnRTdWJzY3JpcHRpb24gPSBudWxsO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsWUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsTUFBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsZUFBQSxHQUFBRixPQUFBO0FBTUEsSUFBQUcsaUJBQUEsR0FBQUgsT0FBQTtBQUVBLElBQUFJLG9CQUFBLEdBQUFKLE9BQUE7QUFLQSxJQUFJSywrQkFBMkQsR0FBRyxJQUFsRTtBQUNBLElBQUlDLDBDQUFzRSxHQUN4RSxJQURGO0FBR0EsSUFBTUMsb0JBQTBELEdBQUcsSUFBSUMsR0FBSixFQUFuRTtBQUtBLElBQU1DLGVBQW1ELEdBQUcsRUFBNUQ7QUFFQSxTQUFTQyxrQkFBVEEsQ0FDRUMsS0FERixFQUVvQztFQUVsQyxPQUFPQSxLQUFLLENBQUNDLFFBQU4sSUFBa0IsSUFBekI7QUFDRDtBQUVELFNBQVNDLFlBQVRBLENBQ0VGLEtBREYsRUFFOEI7RUFDNUIsT0FBT0EsS0FBSyxDQUFDRyxTQUFOLElBQW1CLElBQTFCO0FBQ0Q7QUFFTSxTQUFTQyxxQkFBVEEsQ0FDTEosS0FESyxF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